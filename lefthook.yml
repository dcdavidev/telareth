source_dir: ./config/lefthook

commit-msg:
  jobs:
    - name: lint commit msg
      run: npx commitlint --verbose --edit {1}

pre-commit:
  follow: true
  parallel: false
  jobs:
    - name: lint and format staged files
      interactive: true
      group:
        piped: true
        jobs:
          - run: nx sync
            stage_fixed: true
          - run: npx eslint --fix {staged_files}
            exclude:
              - '*.sh'
              - '*.toml'
              - '*.yaml'
              - '*.yml'
            stage_fixed: true
          - run: npx prettier {staged_files} --write
            glob:
              - '*.sh'
              - '*.toml'
              - '*.yaml'
              - '*.yml'
            stage_fixed: true

pre-push:
  commands:
    branch-name-check:
      run: |
        BRANCH="$(git symbolic-ref --short HEAD)"
        PATTERN='^(feat|fix|chore|docs|refactor|test|perf)\/[a-z0-9._-]+(-[a-z0-9._-]+)*$'
        if ! echo "$BRANCH" | grep -Eq "$PATTERN"; then
          echo "✖ Invalid branch name: $BRANCH"
          echo "  Expected format: <type>/<scope>[-<short-description>]"
          echo "  Allowed types: feat, fix, chore, docs, refactor, test, perf"
          exit 1
        fi
        echo "✅ Branch name ok: $BRANCH"
